<div class="col-lg-3 col-md-4 col-6 mb-4 product-item fade-in-up" style="animation-delay: <%= (typeof index !== 'undefined' ? index * 0.05 : 0) %>s">
  <div class="card product-card h-100 <%= (product.stockQuantity <= 0) ? 'out-of-stock' : '' %>">
    <a href="/product/<%= product._id %>" class="text-decoration-none">
      <div class="position-relative overflow-hidden">
        <img src="/images/<%= product.image || 'product1.svg' %>" class="card-img-top" alt="<%= product.name %>" onerror="this.src='/images/product1.svg'">
        <% if (product.stockQuantity <= 0) { %>
          <div class="position-absolute top-0 end-0 m-2"><span class="badge bg-danger">Out of Stock</span></div>
        <% } else if (product.stockQuantity <= 5) { %>
          <div class="position-absolute top-0 end-0 m-2"><span class="badge bg-warning text-dark"><%= product.stockQuantity %> left</span></div>
        <% } else { %>
          <div class="position-absolute top-0 end-0 m-2"><span class="badge bg-success">In Stock</span></div>
        <% } %>
      </div>
    </a>
    <div class="card-body d-flex flex-column p-2 p-md-3">
      <a href="/product/<%= product._id %>" class="text-decoration-none">
        <h6 class="card-title mb-1 text-truncate text-dark"><%= product.name %></h6>
      </a>
      <p class="card-text text-muted small mb-2 flex-grow-1 d-none d-md-block" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
        <%= product.description %>
      </p>
      <div class="mb-2">
        <span class="h6 text-primary fw-bold">$<%= (product.basePrice || product.price || 0).toFixed(2) %></span>
      </div>
      <div class="d-flex gap-1">
        <button class="btn btn-primary btn-sm flex-grow-1 quick-add-btn" data-product-id="<%= product._id %>" <%= product.stockQuantity <= 0 ? 'disabled' : '' %>>
          <i class="fas fa-cart-plus"></i>
        </button>
        <button class="btn btn-outline-secondary btn-sm quick-view-btn" data-product-id="<%= product._id %>">
          <i class="fas fa-eye"></i>
        </button>
      </div>
    </div>
  </div>
</div>
