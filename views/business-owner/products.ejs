<%- include('../include/admin-header') %>

<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="mb-3"><i class="fas fa-box me-2"></i>My Products</h2>
            <p class="text-muted">Manage your product inventory and edit product details.</p>
        </div>
    </div>

    <!-- Quick Action Button -->
    <div class="row mb-4">
        <div class="col-12">
            <a href="/business-owner/add-product" class="btn btn-success btn-lg">
                <i class="fas fa-plus-circle me-2"></i>Add New Product
            </a>
        </div>
    </div>

    <!-- Products Table -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        All Products (<%= products.length %>)
                    </h6>
                </div>
                <div class="card-body">
                    <% if (products.length > 0) { %>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Name</th>
                                        <th>Category</th>
                                        <th>Price</th>
                                        <th>Stock</th>
                                        <th>Delivery</th>
                                        <th>Date Added</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% products.forEach(product => { %>
                                        <tr>
                                            <td>
                                                <img src="/images/<%= product.image %>" 
                                                     alt="<%= product.name %>" 
                                                     style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;"
                                                     onerror="this.src='/images/product1.svg'">
                                            </td>
                                            <td>
                                                <strong><%= product.name %></strong>
                                                <br>
                                                <small class="text-muted"><%= product.description.substring(0, 50) %>...</small>
                                            </td>
                                            <td><span class="badge badge-info"><%= product.category %></span></td>
                                            <td>
                                                <strong><%= product.basePrice ? product.basePrice.toLocaleString() : '0.00' %></strong>
                                                <% if (product.sizes && product.sizes.length > 0) { %>
                                                    <br><small class="text-muted"><%= product.sizes.length %> sizes</small>
                                                <% } %>
                                            </td>
                                            <td>
                                                <% if (product.stockQuantity > 0) { %>
                                                    <span class="badge badge-success"><%= product.stockQuantity %> in stock</span>
                                                <% } else { %>
                                                    <span class="badge badge-danger">Out of stock</span>
                                                <% } %>
                                            </td>
                                            <td>
                                                <span class="badge badge-primary">
                                                    <i class="fas fa-truck me-1"></i>
                                                    <%= product.deliveryTime || 14 %> days
                                                </span>
                                            </td>
                                            <td>
                                                <% if (product.createdAt) { %>
                                                    <%= product.createdAt.toLocaleDateString() %>
                                                <% } else { %>
                                                    <span class="text-muted">-</span>
                                                <% } %>
                                            </td>
                                            <td>
                                                <div class="btn-group" role="group">
                                                    <a href="/business-owner/products/<%= product._id %>/edit" 
                                                       class="btn btn-sm btn-primary"
                                                       title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                    <a href="/product/<%= product._id %>" 
                                                       target="_blank" 
                                                       class="btn btn-sm btn-info"
                                                       title="View">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <form method="POST" 
                                                          action="/business-owner/products/<%= product._id %>/delete" 
                                                          style="display: inline;" 
                                                          onsubmit="return confirm('Are you sure you want to delete this product?')">
                                                        <button type="submit" 
                                                                class="btn btn-sm btn-danger"
                                                                title="Delete">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </form>
                                                </div>
                                            </td>
                                        </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                        </div>
                    <% } else { %>
                        <div class="text-center py-5">
                            <i class="fas fa-box-open fa-4x text-muted mb-3"></i>
                            <h4 class="text-muted">No Products Yet</h4>
                            <p class="text-muted">Start building your catalog by adding your first product!</p>
                            <a href="/business-owner/add-product" class="btn btn-success btn-lg">
                                <i class="fas fa-plus-circle me-2"></i>Add Your First Product
                            </a>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include('../include/admin-footer') %>
